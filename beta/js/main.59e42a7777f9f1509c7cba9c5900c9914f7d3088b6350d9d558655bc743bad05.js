(()=>{var o={observers:{intersection:null,video:null,load:null},handlers:{navToggle:null,navLinks:new Map,options:new Map,helpToggle:null,introScroll:null},abortControllers:new Set,preloadedVideos:new Set,createDebouncedScrollHandler(){let e;return function(){clearTimeout(e),e=setTimeout(()=>{let{scrollLeft:t,scrollWidth:i,clientWidth:n}=this;document.querySelector(".scroll-mask.left")?.classList.toggle("scrolled",t>16),document.querySelector(".scroll-mask.right")?.classList.toggle("scrolled",t<i-n)},16)}},delayedInit(e,t=25){setTimeout(()=>{try{e()}catch(i){console.error("Initialization error:",i)}},t)},addEventListenerWithCleanup(e,t,i,n={}){let r=new AbortController;return this.abortControllers.add(r),e.addEventListener(t,i,{...n,signal:r.signal}),r},initializeNavToggle(){let e=document.getElementById("nav-toggle"),t=document.getElementById("main-nav");if(!e||!t)return;this.handlers.navToggle=()=>{t.classList.toggle("open")},this.addEventListenerWithCleanup(e,"click",this.handlers.navToggle),document.querySelectorAll("#main-nav a").forEach(n=>{let r=()=>{window.innerWidth<=540&&t.classList.remove("open")};this.addEventListenerWithCleanup(n,"click",r),this.handlers.navLinks.set(n,r)})},initializeOptions(){let e=document.querySelector("#intro");e&&e.querySelectorAll(".option").forEach(t=>{let i=()=>{e.querySelectorAll(".active").forEach(r=>r.classList.remove("active")),t.classList.add("active");let n=t.classList[1];e.querySelector(`.message.${n}`)?.classList.add("active")};this.addEventListenerWithCleanup(t,"click",i),this.handlers.options.set(t,i)})},initializeIntroScroll(){let e=document.querySelector(".intro-options");e&&(this.handlers.introScroll=this.createDebouncedScrollHandler(),this.addEventListenerWithCleanup(e,"scroll",this.handlers.introScroll))},initializeIntersectionObserver(){let e=document.querySelectorAll("section[id]"),t=document.querySelectorAll('#main-nav a[href^="#"]');if(this.observers.intersection&&this.observers.intersection.disconnect(),!(e.length===0||t.length===0))try{this.observers.intersection=new IntersectionObserver(i=>{i.forEach(n=>{if(n.isIntersecting){let r=document.querySelector(`#main-nav a[href="#${n.target.id}"]`);r&&(document.querySelectorAll("#main-nav li").forEach(s=>s.classList.remove("active")),r.parentElement.classList.add("active"))}})},{threshold:.1,rootMargin:"-10% 0px"}),e.forEach(i=>this.observers.intersection.observe(i))}catch(i){console.error("Failed to create intersection observer:",i)}},initializeLoadAnimations(){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches){document.querySelectorAll(".on-load").forEach(i=>i.classList.add("loaded-in"));return}let e=document.querySelectorAll(".on-load");if(e.length===0)return;let t=70;try{this.observers.load=new IntersectionObserver(i=>{i.sort((n,r)=>n.target.compareDocumentPosition(r.target)&Node.DOCUMENT_POSITION_FOLLOWING?-1:1),i.forEach((n,r)=>{n.isIntersecting&&(setTimeout(()=>{n.target.classList.add("loaded-in")},r*t),this.observers.load.unobserve(n.target))})},{threshold:.1,rootMargin:"-5% 0px"}),e.forEach(i=>{this.observers.load.observe(i)})}catch(i){console.error("Failed to create load animation observer:",i)}},initializeHelpToggle(){let e=document.getElementById("case-more-toggle"),t=document.querySelector(".case-more");if(!e||!t)return;let i=e.querySelector("span");i&&(this.handlers.helpToggle=()=>{let n=t.classList.toggle("triggered");i.textContent=n?"F\xF6rminska bakgrund":"Expandera bakgrund"},this.addEventListenerWithCleanup(e,"click",this.handlers.helpToggle))},initializeVideoPreload(){let e=document.querySelectorAll("video");e.length!==0&&e.forEach(t=>{let i=t.src||t.currentSrc;this.preloadedVideos.has(i)||(t.preload="metadata",t.load(),this.preloadedVideos.add(i),t.addEventListener("loadedmetadata",()=>{t.currentTime=.1},{once:!0}))})},initializeVideoObserver(){let e=document.querySelectorAll("video");if(e.length!==0){this.observers.video&&(this.observers.video.disconnect(),this.observers.video=null);try{this.observers.video=new IntersectionObserver(t=>{t.forEach(i=>{let n=i.target;i.isIntersecting?n.paused&&(n.currentTime=0,n.play().catch(()=>{console.log("Video autoplay failed for:",n.src)})):n.paused||(n.pause(),n.currentTime=0)})},{threshold:.1,rootMargin:"50px"}),e.forEach(t=>{this.observers.video.observe(t)})}catch(t){console.error("Failed to create video observer:",t)}}},initializePageElements(){this.initializeNavToggle(),this.initializeOptions(),this.initializeIntroScroll(),this.initializeIntersectionObserver(),this.initializeHelpToggle(),this.initializeVideoPreload()},initializeDelayedElements(){this.initializeLoadAnimations(),setTimeout(()=>{this.initializeVideoObserver()},100)},cleanup(){Object.values(this.observers).forEach(e=>{e&&e.disconnect()}),this.observers={intersection:null,video:null,load:null},this.abortControllers.forEach(e=>{e.abort()}),this.abortControllers.clear(),this.handlers={navToggle:null,navLinks:new Map,options:new Map,helpToggle:null,introScroll:null}}};document.addEventListener("DOMContentLoaded",()=>{let e=new Swup({plugins:[new SwupHeadPlugin]});o.initializePageElements(),initializeTester(),o.delayedInit(()=>{o.initializeDelayedElements()}),e.hooks.on("page:view",()=>{o.initializePageElements(),initializeTester()}),e.hooks.on("animation:in:end",()=>{o.delayedInit(()=>{o.initializeDelayedElements()})}),window.addEventListener("popstate",()=>{o.delayedInit(()=>{o.initializeDelayedElements()})}),e.hooks.on("animation:out:start",()=>{o.cleanup()})});})();
